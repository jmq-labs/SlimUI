function go(e){$.when($(".MENU_LIST").hide("fade",100)).done(function(){var t="",n="config/system/master.php?uqid="+UQID+"&page=../";$("#MAIN"+CurrentFrame).attr("folder")&&(t=$("#MAIN"+CurrentFrame).attr("folder"));var i=n+t;$("#MAIN"+CurrentFrame).attr("isasp")&&(e+="&asp=true"),$("#MAIN"+CurrentFrame).attr("safeMode")&&$("#MAIN"+CurrentFrame).attr("isasp")?$("#MAIN"+CurrentFrame).attr("src",t.substr(3)+e.replace("&asp=true","")):$("#MAIN"+CurrentFrame).attr("src",i+e),parent.eLog("Menu navigation handler","URL : "+e)})}function setSession(e,t){function n(e){$(a.getUserInfo())[0].dev_user&&$.ajax({url:UPDATE_SERVER+"/manifest.json",async:!1,jsonpCallback:"jsonCallback",contentType:"application/json",dataType:"jsonp",success:function(e){VERSION<e.version&&NewNotif(!1,LANG_SOFT_UPDATE_NEWUPD,"update/_update.php&newver="+e.version+"&package="+e["package"]+"&build="+e.build)}}),e&&e()}if(t){var a=function(){var e=new Array;return $.ajax({type:"GET",url:"config/api.php",dataType:"json",cache:!1,data:{userinfo:"true",uqid:UQID},async:!1,success:function(t){e[0]=t}}),$.ajax({type:"GET",url:"config/api.php",dataType:"json",cache:!1,data:{cookiedata:"true",uqid:UQID},async:!1,success:function(t){e[1]=t}}),{getUserInfo:function(){return e[0]?e[0]:!1},getCookieOptions:function(){return e[1]?e[1]:!1}}}();activeUsr=e,displayName=activeUsr,FILTER_BY&&(_key=$(a.getUserInfo())[0][FILTER_BY]);var o="<img class='USER_PROFILE_IMG' src='content/themes/"+THEME+"/img/profile-picture.png' /><div class='SEPARATOR'></div>",r="<div><label id='USER_NAME' ></label><br /><a id='SESSION_OFF'>"+LANG_MAIN_CLOSESESSION+"</a></div>";for("MOBILE"==DEVICE_TYPE?activeUsr.length>20&&(displayName=displayName.substr(0,20)+"..."):activeUsr.length>35&&(displayName=displayName.substr(0,35)+"..."),$("#USER_SESSION_DATA").html(o+r),$("#USER_NAME").html(displayName),$("#WM_LOGO").attr("src","content/img/home.png"),$("#WM_LOGO_DROPMENU").show("fade",150),$(".SEPARATOR").show("fade",150),$(".USER_PROFILE").show("fade",150,function(){$("#WM_LOGO_DROPMENU").click(function(){$("#WIDGET_MENU").toggle("blind",150)}),$("#WM_LOGO").click(function(){MainMenu()}),n(function(){MainMenu()})}),$("#SESSION_OFF").click(function(){SlimAlert(LANG_MAIN_CLOSESESSIONMSG,function(){LogOff()})}),$("#WIDGET_MENU").load("config/appsmenu.php?uqid="+UQID,function(){$("#MAIN_MENU").SlimMenu(),$(".WIDGET_BUTTON").SlimButton("Big"),$(".FRAME").SlimFrame(),$(".INPUT_BUTTON").SlimButton(),$("#WIDGET_MENU ._WIDGET_BUTTON").click(function(e){e.stopPropagation(),$("#WIDGET_MENU").hide("blind",150),$("#WIDGET_MENU").promise().done(function(){ClearMenu(),NewDOM(e.target,WHid++)})}),$("#WIDGET_MENU ._WIDGET_BUTTON").each(function(){var e=$(this).attr("push"),t=$(this).attr("folder"),n=$(this);e&&t&&setInterval(function(){PushService(t.substring(3)+e,n)},5e3)})}),i=0;i<$(a.getCookieOptions()).length;i++)cookie_data+=$(a.getUserInfo())[0][$(a.getCookieOptions())[i][0]]+";";setCookie("slimtoken",cookie_data.slice(0,-1),1),parent.eLog("Login event","Navegador: "+browserName+" Ver. "+majorVersion),$.get("http://ipinfo.io",function(e){parent.eLog("Client Ip address",e.ip)},"jsonp")}else window.location="index.php"}function PushService(e,t){$.ajax({type:"GET",url:e,dataType:"json",cache:!1,async:!0,success:function(e){e.notification.id&&-1==_notifications.indexOf(e.notification.id)&&(_notifications.push(e.notification.id),NewNotif(t,e.notification.message,e.notification.url))}})}function ClearMenu(){$("#MENU_CONTAINER").removeClass("_MENU"),$("#MENU_CONTAINER").addClass("MENU"),$("#MENU_CONTAINER").html("")}function LogOff(){document.location.href=WWWROOT+"?kill_session=true"}function ShowDOM(e,t){function n(e,t){var n=document.createElement("script");n.type="text/javascript",n.readyState?n.onreadystatechange=function(){("loaded"==n.readyState||"complete"==n.readyState)&&(n.onreadystatechange=null,t())}:n.onload=function(){t()},n.src=e,$("#MAIN"+CurrentFrame).contents().find("head")[0].appendChild(n)}"MOBILE"==DEVICE_TYPE&&$(".MAIN").hide(),CurrentFrame=$(e).attr("pid"),$(".MAIN_DIV").css("height",window.innerHeight-$("#MAIN_MENU").outerHeight()),1==t&&$(e).attr("isasp")&&($.get("config/system/master.php?getheaders=true&uqid="+UQID,function(e){$("#MAIN"+CurrentFrame).contents().find("head").append(e)}),$("#MAIN"+CurrentFrame).contents().find("body").hide(),n(WWWROOT+"content/scripts/jquery/jquery-1.11.2.min.js",function(){n(WWWROOT+"content/scripts/jquery/jquery-ui.min.js",function(){n(WWWROOT+"content/scripts/slim-ui.min.js",function(){n(WWWROOT+"content/plugins/timepicker/jquery-ui-timepicker.js",function(){n(WWWROOT+"content/plugins/mask/qunit-1.11.0.js",function(){n(WWWROOT+"content/plugins/mask/jquery.mask.js",function(){n(WWWROOT+"content/scripts/safemode.js",function(){$("#MAIN"+CurrentFrame).contents().find("body").show()})})})})})})})),$(e).attr("appmenu")&&$("#MENU_CONTAINER").is(":empty")&&(ClearMenu(),$.get($(e).attr("appmenu"),function(t){$load_app_menus=$.ajax({type:"GET",url:WWWROOT+$(e).attr("folder").substr(3)+"appid.xml",dataType:"xml",cache:!1,success:function(e){var n=$("display_menu_filters",e).children().length,a=$("display_menu_filters",e).children();for($("#MENU_CONTAINER").append(t),i=0;i<n;i++){var o=a[i].childNodes[0].data.split(",");-1==o.indexOf(_key)&&_key&&$("#"+a.get(i).tagName).remove()}}})})),$(e).show("fade",150),$(e).css("z-index",1)}function NewDOM(e,t,n,i,a){if(e){var o=$(e).attr("url")+"&uqid="+UQID;if(n||(_safeMode&&(n=!0),$(e).attr("safemode")&&(n=!0)),1==n&&$(e).attr("isasp")&&(o=$(e).attr("url").substr("36").replace("&asp=true","")),"LABEL"!=e.tagName){if(t){var r=$("<iframe/>",{id:"MAIN"+t,uqid:UQID,Class:"MAIN MAIN_DIV",pid:t,appname:$(e).attr("appname"),src:o,onload_src:$(e).attr("onload_src"),isasp:$(e).attr("isasp"),folder:$(e).attr("folder"),safemode:n,appmenu:$(e).attr("appmenu"),style:"display:none",load:function(){i||ShowDOM(this,n)}});$("#MAIN_CONTAINER").append(r),HistoryWidget(t,$(e).attr("title"),$(e).attr("icon"),$(e).attr("color"))}}else $(e).parent().trigger("click")}else if(i&&t){var a=a+"&uqid="+UQID,r=$("<iframe/>",{id:"MAIN"+t,uqid:UQID,Class:"MAIN MAIN_DIV",pid:t,appname:"notification",src:a,style:"display:none"});$("#MAIN_CONTAINER").append(r),HistoryWidget(t,!1,!1,!1,i)}}function MainMenu(e){null!=$load_app_menus&&($load_app_menus.abort(),$load_app_menus=null),$(".MAIN").hide("fade",150,function(){$(".HISTORY_WIDGET").each(function(){if($(this).hasClass("NEW")){var e=$(this).attr("pid");$(this).show().animate({opacity:1,marginLeft:"+=25"},200),$(this).children(".HWIDGET_REMOVE").click(function(t){t.stopPropagation(),$(this).parent(".HISTORY_WIDGET").animate({opacity:0,marginLeft:"-=200"},200,function(){$(".MAIN").each(function(){$(this).attr("pid")==e&&"MAIN"!=$(this).attr("id")&&$(this).remove()}),$(this).remove()})}),$(this).unbind("click"),$(this).click(function(){CurrentFrame=e,$(".HISTORY_WIDGET").hide(),$(".MAIN").hide(),ShowDOM($("#MAIN"+$(this).attr("pid"))),parent.eLog("Interface handler","Open widget : "+$(this).attr("title"))}),$(this).removeClass("NEW")}}),$(".HISTORY_WIDGET").show()}),parent.eLog("Interface handler","Show desktop"),ClearMenu(),e&&e()}function HistoryWidget(e,t,n,i,a){$("#HISTORY_WIDGETS").append(a?"<div id='HW_"+e+"' pid='"+e+"' class='WIDGET_BUTTON HISTORY_WIDGET NEW NOTIFICATION_WIDGET' title='' ><img src='content/img/clock.png' /><div class='NOTIF_TXT'><label>"+a+"</label></div><div class='HWIDGET_REMOVE _VOID'><img src='content/img/widget-close.png' /></div></div>":"<div id='HW_"+e+"' pid='"+e+"' class='WIDGET_BUTTON HISTORY_WIDGET NEW' title='"+t+"' icon='"+n+"' color='"+i+"' ><img src='content/img/clock.png' /><div class='HWIDGET_REMOVE _VOID'><img src='content/img/widget-close.png' /></div></div>"),$(".WIDGET_BUTTON").SlimButton("Big"),$(".HISTORY_WIDGET").hide()}function NewNotif(e,t,n){var i=WHid++;if(NewDOM(e,i,!1,t,"config/system/master.php?page="+n),0==$(".MAIN:visible").length&&MainMenu(),"granted"!==Notification.permission)Notification.requestPermission();else{var a=new Notification($("title").text(),{icon:"content/img/iosicon.png",body:t});setTimeout(function(){a.close()},7e3),a.onclick=function(){self.focus(),MainMenu(function(){ShowDOM("#MAIN"+i)})}}}function setCookie(e,t,n){eraseCookie(e);var i=new Date;i.setDate(i.getDate()+n);var a=escape(t)+(null==n?"":"; expires="+i.toUTCString());document.cookie=e+"="+a}function getCookie(e){var t=document.cookie,n=t.indexOf(" "+e+"=");if(-1==n&&(n=t.indexOf(e+"=")),-1==n)t=null;else{n=t.indexOf("=",n)+1;var i=t.indexOf(";",n);-1==i&&(i=t.length),t=unescape(t.substring(n,i))}return t}function checkCookie(e){var e=getCookie(e);return null!=e&&""!=e?!0:!1}function eraseCookie(e){document.cookie=e+"=; Max-Age=0"}function HideMenu(e){$("#"+e).hide()}function ShowMenu(e){$("#"+e).show()}function ConfirmAsp(e,t){return 0==_confirmCallback&&parent.SlimAlert(e,function(){_confirmCallback=!0,$.when($(t).trigger("click")).then(function(){_confirmCallback=!1})}),_confirmCallback}var WHid=1,activeUsr="",CurrentFrame=0,_safeMode,_key,_confirmCallback=!1,cookie_data="",$load_app_menus,_notifications=new Array,loginFrame="<iframe id='MAIN0' class='MAIN MAIN_DIV' pid='0' onload='ShowDOM(this)' src='config/system/master.php?uqid="+UQID+"&page=login.php&auth=true' ></iframe>";$(function(){function e(){parent.eLog("Window event","Close")}$("body").append(loginFrame),$("#MAIN_MENU").show().animate({display:"block",opacity:1,marginLeft:"+=25"},200),$(window).bind("hashchange",function(){parent.window.location(WWWROOT)}),"x-mas"==THEME&&$.getScript("content/themes/x-mas/snow.js");var t="<p><a href='http://www.google.com/intl/en/chrome/browser/'><img  style='border:none;' src='content/img/chromelogo.png' /></a></p>";-1==browserName.indexOf("Chrome")&&-1==browserName.indexOf("Safari")&&-1==browserName.indexOf("Mobile")&&(SlimAlert(LANG_LOGIN_BROWSER_COMP+t),_safeMode=!0),window.navigator.standalone&&$("body").css("padding-top","20px"),$.ajaxSetup({cache:AJAX_CACHE===!0?!0:!1}),$(document).ajaxStart(function(){$("#PROGRESS").length<1&&($("body").prepend("<div id='PROGRESS'></div>"),$("#PROGRESS").delay(1e3).show("fade"))}),$(document).ajaxSuccess(function(){$("#PROGRESS").remove(),$("#MENU_CONTAINER").SlimMenu()}),$(document).ajaxError(function(){}),$("img, div, label, xmp").click(function(e){var t=$(e.target);t.hasClass("_VOID")||t.hasClass("METAEDITABLE")||(parent.$(".MENU_LIST").hide("fade",100),parent.$("#WIDGET_MENU").hide("blind",150),$(".TASKWIDGET").remove())}),window.onbeforeunload=e});