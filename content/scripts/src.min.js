function go(e){$.when($(".MENU_LIST").hide("fade",100)).done(function(){var n="",t="config/system/master.php?uqid="+UQID+"&page=../";$("#MAIN"+CurrentFrame).attr("folder")&&(n=$("#MAIN"+CurrentFrame).attr("folder"));var i=t+n;$("#MAIN"+CurrentFrame).attr("isasp")&&(e+="&asp=true"),$("#MAIN"+CurrentFrame).attr("safeMode")&&$("#MAIN"+CurrentFrame).attr("isasp")?$("#MAIN"+CurrentFrame).attr("src",n.substr(3)+e.replace("&asp=true","")):$("#MAIN"+CurrentFrame).attr("src",i+e),parent.eLog("Menu navigation handler","URL : "+e)})}function setSession(e,n){function t(e){$(a.getUserInfo())[0].dev_user&&$.ajax({url:UPDATE_SERVER+"/manifest.json",async:!1,jsonpCallback:"jsonCallback",contentType:"application/json",dataType:"jsonp",success:function(e){VERSION<e.version&&NewNotif(!1,LANG_SOFT_UPDATE_NEWUPD,"update/_update.php&newver="+e.version+"&package="+e.package+"&build="+e.build)}}),e&&e()}if(n){var a=function(){var e=new Array;return $.ajax({type:"GET",url:"config/api.php",dataType:"json",cache:!1,data:{userinfo:"true",uqid:UQID},async:!1,success:function(n){e[0]=n}}),$.ajax({type:"GET",url:"config/api.php",dataType:"json",cache:!1,data:{cookiedata:"true",uqid:UQID},async:!1,success:function(n){e[1]=n}}),{getUserInfo:function(){return!!e[0]&&e[0]},getCookieOptions:function(){return!!e[1]&&e[1]}}}();$(document).ajaxStart(function(){Session_Expired(function(){SlimAlert(LANG_MAIN_SESSIONEXPIRED,function(){LogOff()})})}),activeUsr=e,displayName=activeUsr,FILTER_BY&&(_key=$(a.getUserInfo())[0][FILTER_BY]),FILTER_BY2&&(_key2=$(a.getUserInfo())[0][FILTER_BY2]);var o="<img class='USER_PROFILE_IMG' src='content/themes/"+THEME+"/img/profile-picture.png' /><div class='SEPARATOR'></div>",s="<div><label id='USER_NAME' ></label><br /><a id='SESSION_OFF'>"+LANG_MAIN_CLOSESESSION+"</a></div>";for("MOBILE"==DEVICE_TYPE?activeUsr.length>20&&(displayName=displayName.substr(0,20)+"..."):activeUsr.length>35&&(displayName=displayName.substr(0,35)+"..."),$("#USER_SESSION_DATA").html(o+s),$("#USER_NAME").html(displayName),$("#WM_LOGO").attr("src","content/img/home.png"),$("#WM_LOGO_DROPMENU").show("fade",150),$(".SEPARATOR").show("fade",150),$(".USER_PROFILE").show("fade",150,function(){$("#WM_LOGO_DROPMENU").click(function(){$("#WIDGET_MENU").toggle("blind",150)}),$("#WM_LOGO").unbind("click").click(function(){MainMenu()}),t(function(){MainMenu()})}),$("#SESSION_OFF").click(function(){SlimAlert(LANG_MAIN_CLOSESESSIONMSG,function(){LogOff()})}),$("#WIDGET_MENU").load("config/appsmenu.php?uqid="+UQID,function(){$("#MAIN_MENU").SlimMenu(),$(".WIDGET_BUTTON").SlimButton("Big"),$(".FRAME").SlimFrame(),$(".INPUT_BUTTON").SlimButton(),$("#WIDGET_MENU ._WIDGET_BUTTON").click(function(e){e.stopPropagation(),$("#WIDGET_MENU").hide("blind",150),$("#WIDGET_MENU").promise().done(function(){ClearMenu(),NewDOM(e.target,WHid++)})}),$("iframe").hide("fade",150,function(){$(this).remove()}),$("#WIDGET_MENU ._WIDGET_BUTTON").each(function(){var e=$(this).attr("push"),n=$(this).attr("folder"),t=$(this);e&&n&&setInterval(function(){PushService(n.substring(3)+e,t)},5e3)})}),i=0;i<$(a.getCookieOptions()).length;i++)cookie_data+=$(a.getUserInfo())[0][$(a.getCookieOptions())[i][0]]+";";setCookie("slimtoken",cookie_data.slice(0,-1),1),parent.eLog("Login event","Navegador: "+browserName+" Ver. "+majorVersion),$.get("http://ipinfo.io",function(e){parent.eLog("Client Ip address",e.ip)},"jsonp")}else window.location="index.php"}function PushService(e,n){$.ajax({type:"GET",url:e,dataType:"json",cache:!1,async:!0,success:function(e){e.notification.id&&-1==_notifications.indexOf(e.notification.id)&&(_notifications.push(e.notification.id),NewNotif(n,e.notification.message,e.notification.url,e.notification.params))}})}function ClearMenu(){$("#MENU_CONTAINER").removeClass("_MENU"),$("#MENU_CONTAINER").addClass("MENU"),$("#MENU_CONTAINER").html("")}function LogOff(){document.location.href=WWWROOT+"?kill_session=true"}function ShowDOM(e,n){function t(e,n){var t=document.createElement("script");t.type="text/javascript",t.readyState?t.onreadystatechange=function(){"loaded"!=t.readyState&&"complete"!=t.readyState||(t.onreadystatechange=null,n())}:t.onload=function(){n()},t.src=e,$("#MAIN"+CurrentFrame).contents().find("head")[0].appendChild(t)}"MOBILE"==DEVICE_TYPE&&$(".MAIN").hide(),CurrentFrame=$(e).attr("pid"),$(".MAIN_DIV").css("height",window.innerHeight-$("#MAIN_MENU").outerHeight()),1==n&&$(e).attr("isasp")&&($.get("config/system/master.php?getheaders=true&uqid="+UQID,function(e){$("#MAIN"+CurrentFrame).contents().find("head").append(e)}),$("#MAIN"+CurrentFrame).contents().find("body").hide(),t(WWWROOT+"content/scripts/jquery/jquery-1.11.2.min.js",function(){t(WWWROOT+"content/scripts/jquery/jquery-ui.min.js",function(){t(WWWROOT+"content/scripts/slim-ui.min.js",function(){t(WWWROOT+"content/plugins/timepicker/jquery-ui-timepicker.js",function(){t(WWWROOT+"content/plugins/mask/qunit-1.11.0.js",function(){t(WWWROOT+"content/plugins/mask/jquery.mask.js",function(){t(WWWROOT+"content/scripts/safemode.js",function(){t(WWWROOT+"content/plugins/idle/iframe_idle.js",function(){$("#MAIN"+CurrentFrame).contents().find("body").show()})})})})})})})})),$(e).attr("appmenu")&&$("#MENU_CONTAINER").is(":empty")&&(ClearMenu(),$.get($(e).attr("appmenu"),function(n){$load_app_menus=$.ajax({type:"GET",url:WWWROOT+$(e).attr("folder").substr(3)+"appid.xml",dataType:"xml",cache:!1,success:function(e){var t=$("display_menu_filters",e).children().length,a=$("display_menu_filters",e).children();for($("#MENU_CONTAINER").append(n),i=0;i<t;i++){var o=a[i].childNodes[0].data.split(",");-1==o.indexOf(_key)&&-1==o.indexOf(_key2)&&$("#"+a.get(i).tagName).remove()}}})})),$(e).show("fade",150),$(e).css("z-index",1)}function NewDOM(e,n,t,i,a,o){if(e){var s=$(e).attr("url")+"&uqid="+UQID;if(o&&(s+="&"+o),t||(_safeMode&&(t=!0),$(e).attr("safemode")&&(t=!0)),1==t&&$(e).attr("isasp")&&(s=$(e).attr("url").substr("36").replace("&asp=true","")),"LABEL"!=e.tagName){if(n){r=$("<iframe/>",{id:"MAIN"+n,uqid:UQID,Class:"MAIN MAIN_DIV",pid:n,appname:$(e).attr("appname"),src:s,onload_src:$(e).attr("onload_src"),isasp:$(e).attr("isasp"),folder:$(e).attr("folder"),safemode:t,appmenu:$(e).attr("appmenu"),style:"display:none",load:function(){i||ShowDOM(this,t)}});$("#MAIN_CONTAINER").append(r),HistoryWidget(n,$(e).attr("title"),$(e).attr("icon"),$(e).css("background-color"))}}else $(e).parent().trigger("click")}else if(i&&n){var a=a+"&uqid="+UQID,r=$("<iframe/>",{id:"MAIN"+n,uqid:UQID,Class:"MAIN MAIN_DIV",pid:n,appname:"notification",src:a,style:"display:none"});$("#MAIN_CONTAINER").append(r),HistoryWidget(n,!1,!1,!1,i)}}function MainMenu(e){null!=$load_app_menus&&($load_app_menus.abort(),$load_app_menus=null),$(".MAIN").hide("fade",150,function(){$(".HISTORY_WIDGET").each(function(){if($(this).hasClass("NEW")){var e=$(this).attr("pid");$(this).show().animate({opacity:1,marginLeft:"+=25"},200),$(this).children(".HWIDGET_REMOVE").click(function(n){n.stopPropagation(),$(this).parent(".HISTORY_WIDGET").animate({opacity:0,marginLeft:"-=200"},200,function(){$(".MAIN").each(function(){$(this).attr("pid")==e&&"MAIN"!=$(this).attr("id")&&$(this).remove()}),$(this).remove()})}),$(this).unbind("click"),$(this).click(function(){CurrentFrame=e,$(".HISTORY_WIDGET").hide(),$(".MAIN").hide(),ShowDOM($("#MAIN"+$(this).attr("pid"))),parent.eLog("Interface handler","Open widget : "+$(this).attr("title"))}),$(this).removeClass("NEW")}}),$(".HISTORY_WIDGET").show()}),parent.eLog("Interface handler","Show desktop"),ClearMenu(),e&&e()}function HistoryWidget(e,n,t,i,a){a?$("#HISTORY_WIDGETS").append("<div id='HW_"+e+"' pid='"+e+"' class='WIDGET_BUTTON HISTORY_WIDGET NEW NOTIFICATION_WIDGET' title='' ><img src='content/img/clock.png' /><div class='NOTIF_TXT'><label>"+a+"</label></div><div class='HWIDGET_REMOVE _VOID'><img src='content/img/widget-close.png' /></div></div>"):$("#HISTORY_WIDGETS").append("<div id='HW_"+e+"' pid='"+e+"' class='WIDGET_BUTTON HISTORY_WIDGET NEW' title='"+n+"' icon='"+t+"' color='"+i+"' ><img src='content/img/clock.png' /><div class='HWIDGET_REMOVE _VOID'><img src='content/img/widget-close.png' /></div></div>"),$(".WIDGET_BUTTON").SlimButton("Big"),$(".HISTORY_WIDGET").hide()}function NewNotif(e,n,t,i){var a=WHid++;if(NewDOM(e,a,!1,n,"config/system/master.php?page="+t,i),0==$(".MAIN:visible").length&&MainMenu(),-1!=browserName.indexOf("Chrome"))if("granted"!==Notification.permission)Notification.requestPermission();else{var o=new Notification($("title").text(),{icon:"content/img/iosicon.png",body:n});setTimeout(function(){o.close()},7e3),o.onclick=function(){self.focus(),MainMenu(function(){ShowDOM("#MAIN"+a)})}}}function setCookie(e,n,t){eraseCookie(e);var i=new Date;i.setDate(i.getDate()+t);var a=escape(n)+(null==t?"":"; expires="+i.toUTCString());document.cookie=e+"="+a}function getCookie(e){var n=document.cookie,t=n.indexOf(" "+e+"=");if(-1==t&&(t=n.indexOf(e+"=")),-1==t)n=null;else{t=n.indexOf("=",t)+1;var i=n.indexOf(";",t);-1==i&&(i=n.length),n=unescape(n.substring(t,i))}return n}function checkCookie(e){return null!=(e=getCookie(e))&&""!=e}function eraseCookie(e){document.cookie=e+"=; Max-Age=0"}function HideMenu(e){$("#"+e).hide()}function ShowMenu(e){$("#"+e).show()}function ConfirmAsp(e,n){return 0==_confirmCallback&&parent.SlimAlert(e,function(){_confirmCallback=!0,$.when($(n).trigger("click")).then(function(){_confirmCallback=!1})}),_confirmCallback}function Session_Expired(e){$.ajax({type:"GET",url:"config/api.php",cache:!1,data:{session_stat:"true"},async:!1,success:function(n){n||e()}})}var WHid=1,activeUsr="",CurrentFrame=0,_safeMode,_key,_key2,_confirmCallback=!1,cookie_data="",$load_app_menus,_notifications=new Array,loginFrame="<iframe id='MAIN0' class='MAIN MAIN_DIV' pid='0' onload='ShowDOM(this)' src='config/system/master.php?uqid="+UQID+"&page=login.php&auth=true' ></iframe>";$(function(){$("#WM_LOGO").click(function(){window.location.href=WWWROOT}),$("#MAIN_CONTAINER").append(loginFrame),$("#MAIN_MENU").show().animate({display:"block",opacity:1,marginLeft:"+=25"},200),"x-mas"==THEME&&$.getScript("content/themes/x-mas/snow.js");-1==browserName.indexOf("Chrome")&&-1==browserName.indexOf("Safari")&&-1==browserName.indexOf("Mobile")&&(SlimAlert(LANG_LOGIN_BROWSER_COMP+"<p><a href='http://www.google.com/intl/en/chrome/browser/'><img  style='border:none;' src='content/img/chromelogo.png' /></a></p>"),_safeMode=!0),window.navigator.standalone&&$("body").css("padding-top","20px"),$.ajaxSetup({cache:!0===AJAX_CACHE}),setIdleTimeout(1e3),setAwayTimeout(1e4),document.onIdle=function(){$("iframe:visible:last")[0].contentWindow.isIdle=!0},document.onAway=function(){},$(document).ajaxStart(function(){$("#PROGRESS").length<1&&($("body").prepend("<div id='PROGRESS'></div>"),$("#PROGRESS").delay(1e3).show("fade"))}),$(document).ajaxSuccess(function(){$("#PROGRESS").remove(),$("#MENU_CONTAINER").SlimMenu()}),$(document).ajaxError(function(e,n,t){}),$("img, div, label, xmp").click(function(e){var n=$(e.target);n.hasClass("_VOID")||n.hasClass("METAEDITABLE")||(parent.$(".MENU_LIST").hide("fade",100),parent.$("#WIDGET_MENU").hide("blind",150),$(".TASKWIDGET").remove())}),window.onbeforeunload=function(){parent.eLog("Window event","Close")}});